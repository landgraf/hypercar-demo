require conf/machine/include/arm/armv8a/tune-cortexa57.inc
require conf/machine/include/qemu.inc

KERNEL_IMAGETYPE = "Image"

# Use the qemuarm64 kernel config as the base config of this machine 
# TODO Add Xen ? 
KMACHINE = "qemuarm64"

# For runqemu
MACHINE_EXTRA_RDEPENDS:append = "u-boot"

IMAGE_FSTYPES += " wic "
WKS_FILE ?= "hypercar-uboot.wks"
UBOOT_MACHINE = "qemu_arm64_defconfig"

QB_SYSTEM_NAME = "qemu-system-aarch64"
QB_MACHINE_VIRT_HIGHMEM = "on"
QB_CPU = "-cpu cortex-a57"
QB_MACHINE = " -machine virtualization=true   -machine virt,gic_version=3"
QB_DEFAULT_BIOS = "u-boot-qemuarm64-xen-uboot.bin"
QB_ROOTFS_OPT = "-drive id=hd0,file=@ROOTFS@,if=none,format=raw -device -device ich9-ahci,id=ahci -device ide-drive,drive=hd0,bus=ahci.0"
IMAGE_BOOT_FILES="${KERNEL_IMAGETYPE} xen-qemuarm64-xen-uboot"


PREFERRED_PROVIDER_virtual/kernel ?= "linux-yocto"
KBUILD_DEFCONFIG = "defconfig"
MACHINE_EXTRA_RRECOMMENDS += "kernel-modules qemu-dtb"
